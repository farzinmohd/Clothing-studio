{% extends 'base.html' %}

{% block content %}
<div class="container text-center mt-5">

    <h2>ğŸ§  AI Skin Tone Recognition</h2>
    <p class="text-muted">Upload a clear face image</p>

    <!-- FORM -->
    <form method="POST"
          enctype="multipart/form-data"
          action="{% url 'ai_result' %}"
          onsubmit="startAI()"
          id="aiForm">
        {% csrf_token %}

        <input type="file"
               name="image"
               class="form-control mb-3"
               required>

        <button class="btn btn-primary" id="analyzeBtn">
            ğŸ” Analyze Image
        </button>
    </form>

    <!-- AI LOADING -->
    <div id="aiLoader" class="mt-5 d-none">
        <div class="spinner-border text-primary mb-3" role="status"></div>
        <h5 id="aiText">Initializing AI engineâ€¦</h5>
        <p class="text-muted">Please wait</p>
    </div>

</div>

<script>
let aiInterval = null;

function startAI() {
    // Hide form
    document.getElementById("aiForm").classList.add("d-none");

    // Show loader
    document.getElementById("aiLoader").classList.remove("d-none");

    // Disable button (safety)
    document.getElementById("analyzeBtn").disabled = true;

    const messages = [
        "Detecting facial regionsâ€¦",
        "Normalizing lighting conditionsâ€¦",
        "Analyzing skin tone patternsâ€¦",
        "Matching fashion databaseâ€¦",
        "Generating recommendationsâ€¦"
    ];

    let i = 0;
    const textEl = document.getElementById("aiText");

    // Clear any old interval
    if (aiInterval) {
        clearInterval(aiInterval);
    }

    aiInterval = setInterval(() => {
        textEl.innerText = messages[i % messages.length];
        i++;
    }, 1200);
}
</script>
{% endblock %}
